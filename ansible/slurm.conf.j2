# slurm.conf generated by Ansible
ClusterName=aws-slurm
SlurmctldHost={{ groups['master'][0] }}

# 핵심 설정
SlurmUser=slurm
SlurmctldPort=6817
SlurmdPort=6818
AuthType=auth/munge
StateSaveLocation=/var/spool/slurmctld
SlurmdSpoolDir=/var/spool/slurmd
SwitchType=switch/none
MungeSocketDir=/var/run/munge

# 로그 및 프로세스
SlurmctldPidFile=/var/run/slurmctld.pid
SlurmdPidFile=/var/run/slurmd.pid
SlurmctldLogFile=/var/log/slurm/slurmctld.log
SlurmdLogFile=/var/log/slurm/slurmd.log

# Accounting 설정
AccountingStorageType=accounting_storage/slurmdbd
AccountingStorageHost={{ groups['accounting'][0] }}
AccountingStoragePort=6819

# 노드 및 파티션 정의
# CPUs 및 RealMemory는 인스턴스 타입에 맞춰 조정 필요
NodeName=cpu-worker-[0-{{ groups['cpu_workers']|length - 1 }}] CPUs=2 State=UNKNOWN
NodeName=gpu-worker-[0-{{ groups['gpu_workers']|length - 1 }}] CPUs=4 Gres=gpu:{{ hostvars[groups['gpu_workers'][0]]['gpu_count'] | default(1) }} State=UNKNOWN

PartitionName=compute Nodes=ALL Default=YES MaxTime=INFINITE State=UP
